<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Circular progress bar (canvas) - jsFiddle demo by oskar</title>
  <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/mootools/1.5.2/mootools-core-compat.min.js'></script>
  <link href='https://fonts.googleapis.com/css?family=Roboto:100' rel='stylesheet' type='text/css'>
  <style type='text/css'>
input {
    width: 200px;
}
canvas {
    clear: both;
    width: 480px;
    margin: 0 auto;
}
body {
    text-align: center;
    background: #000;
}
h1 {
    font-family: 'Roboto';
    margin: 1em 0;
    color: #fff;
    font-weight: 100;
}
  </style>
<script type='text/javascript'>//<![CDATA[
var myFx, pressurized = false;
window.addEvent('load', function() {
// SVG stuff
var range = document.id('range');
var canvas = document.getElementById('counter');
var ctx = ctx = canvas.getContext('2d');
var imd = null;
var circ = Math.PI * 2;
var quart = Math.PI / 2;
/*
ctx.beginPath();
ctx.strokeStyle = 'blue';
ctx.lineCap = 'square';
ctx.closePath();
ctx.fill();
ctx.lineWidth = 9.0;
*/
imd = ctx.getImageData(0, 0, canvas.width, canvas.height);
ctx.font = "40px 'Roboto'";
var draw = function(current) {
    ctx.beginPath();
    ctx.strokeStyle = 'rgba(255,255,255,0.2)';
    ctx.lineCap = 'square';
    ctx.closePath();
    ctx.fill();
    ctx.lineWidth = 7.0;
    ctx.beginPath();
    ctx.putImageData(imd, 0, 0);
    ctx.arc(canvas.width/2, canvas.height/2, canvas.height/2-10, -quart, (circ) - quart, false);
    ctx.stroke();
    ctx.beginPath();
    ctx.strokeStyle = '#0072D4';
    ctx.lineCap = 'square';
    ctx.closePath();
    ctx.fill();
    ctx.lineWidth = 7.0;
    ctx.beginPath();
    ctx.arc(canvas.width/2, canvas.height/2, canvas.height/2-10, -(quart), ((circ) * current) - quart, false);
    ctx.stroke();
    ctx.font = "40px 'Roboto'";
    ctx.fillStyle = "white";
    ctx.textAlign = "center";
    ctx.fillText(Math.round((current)*100)+"%", canvas.width/2, canvas.height/2-20);
    if(current<0.5) {
        ctx.fillStyle = "red";
    } else {
        ctx.fillStyle = "#00ff00";
    }
    ctx.fillText(current<0.5?(current<0.2?"Critical Pressure":"Low Pressure"):"Pressure Stable", canvas.width/2, canvas.height/2+20);
    if(current == 1) pressurized = true;
}

range.addEvents({
    mousemove: function() {
        draw(this.value / 100);
    }
});

myFx = new Fx({
    duration: 16000,
    transition: 'bounce:out',
    onStep: function(step) {
        draw(step / 100);
        range.set('value', step);
    }
});

myFx.set = function(now){
    var ret = Fx.prototype.set.call(this, now);
    this.fireEvent('step', now);
    return ret;
};

setTimeout(function() {draw(0); setTimeout(function() {draw(0);}, 100);}, 100);
});//]]> 
function stabilizePressure() {
    if(pressurized) return;
    myFx.start(0, 100);
}
</script>

</head>
<body>
  <input id="range" type="range" min="0" max="100" style="display: none;" />
  <h1>Click the circle to pressurize</h1>
<a href="javascript:;" onclick="stabilizePressure();"><canvas id="counter" width="500" height="500"></canvas></a> 
</body>

</html>

